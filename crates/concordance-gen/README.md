# Concordance Code Generator
This crate is an _opt-in_ code generation tool for developers building applications using Concordance. If you are building
your event sourced components in **Rust**, then you'll be able to use this crate from your `build.rs` file in your projects
to generate markdown documentation, reusable traits, and trait implementation wrappers.

## Opinions
Note that at the moment there are a number of opinions codified in the code generated by this crate.

* All model structs (e.g. events, commands, etc) must be in scope at the root of your actor (e.g. `lib.rs`). In the bank account example, this is done by using all of the types from the model crate. 
* All **state** structs for process managers and aggregates must also be in scope in the root of your module. This currently avoids potentially cumbersome configuration telling the generated code how and where to find your state structs.
* All of the data types from Concordance itself must also be in scope in the module root. By convention, we generate the concordance types in each module rather than having yet another shared dependency.

A `lib.rs` module that makes use of both generated traits and generated implementations might contain the following preamble:

```rust
// generated via Smithy from concordance/interface
use eventsourcing::*;
// generated via the concordance-gen crate
use genimpl::*;
// generated via the concordance-gen crate
use system_traits::*;

use serde::{Deserialize, Serialize};
use wasmbus_rpc::actor::prelude::*;

use bankaccount_model::commands::*;
use bankaccount_model::events::*;
use bankaccount_model::state::*;
```

Note that `eventsourcing` here comes from the `concordance/interface` directory via code generation, and `bankaccount_model` is a shared crate containing manually defined data types.

A sample `build.rs` file that generates traits, docs, and an implementation wrapper might look like the following:

```rust
use concordance_gen::EntityType;

const CONFIG: &str = "./codegen.toml";

fn main() -> Result<(), Box<dyn std::error::Error>> {
    weld_codegen::rust_build(CONFIG)?; // smithy codegen for Concordance types

    // Generate markdown docs (add-on to Concordance)
    concordance_gen::generate_doc("../bankaccount-model.ttl".into(), "../model/docs".into())?;

    // Generate the relevant traits (add-on to Concordance)
    concordance_gen::generate_system_traits("../bankaccount-model.ttl".into(), "./src".into())?;

    // Generate the implementation wrappers (add-on to Concordance)
    concordance_gen::generate_impl(
        "../bankaccount-model.ttl".into(),
        "./src".into(),
        "bankaccount".into(),
        EntityType::Aggregate,
        "".to_string(),
    )?;
    Ok(())
}
```